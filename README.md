mithril-isomorphic
==================

An attempt at making Mithril work both on the client and the server.

Installation
============

Clone this repository or download the zip file and expand.

Run `npm install` in the project folder to install the dependencies.

So far..
========

This is a work in progress.  Sorry if at any point it gets unstable.

So far:

If you do `node server.js` and then browse to `localhost:8000` as the console message suggests
you will be able to get to a sample application.  

You will see the image twice.  The top one is generated by Mithril on the client side, 
the bottom is generated at the server side.  

If you click on the tabs on the top copy, the contents of those tabs will change without going to the server
while the bottom copy will remain the same.

If you click then on the bottom copy, the contents of both will change after a trip to the server.

`server.js` contains several configuration parameters which are set to their defaults anyway.

* `app: './app'` points to the location of the files that constitute the application.
* `routes: 'routes.js'` points to the file, within the application folder, for the routes or the module declaration.
* `page: 'index.html'` points to the single page frame
* `root: 'client'` the folder which will become the root for the web site.
* `script: '__.js'` the file that will contain the concatenation of all the JS files in the application, including Mithril.

For the default configuration, you just need to add this to the express server script:

	app.use(require('mithril-isomorphic')());

The `routes.js` files is slightly modified from the standard arguments to `m.route()`:

	module.exports = function (m) {
		m.route('/', {
			'/': 'app',
			'/:tab': 'app'
		});
	};

* It should be exported as any node module.  
* The route configuration is missing the first argument, the document root, as there is as yet no document.
* The module name is given as a string (`'app'` instead of `app`) as there is no instance of it yet.

The application can be made of any number of individual files.

	module.exports = function (m) {

		app = {
			// The regular application goes here
		};
		return app;
	};

The module is defined as normal within the exported function which will be called with the instance of Mithril.
The file containing the module should be named as the module itself with the `.js` extension appended.
The name of the module is the one used in the `routes` file above.
If the same module is split into several files, the file containing the controller should have the file
named after it and is the only one that needs to return the module instance.

The home page `index.html`by default should contain a placeholder `{{body}}` somewhere within the body.
It will be replaced by the static version of the page plus the  scripts to make it active, including Mithril itself.

So far, the Mithril files themselves have not been changed but I am afraid I will have to, eventually, by making
some properties public.

I have used the [mock DOM](https://github.com/lhorie/mithril.js/blob/master/tests/mock.js) 
used for testing with very slight modifications, instead of attempting to use a more
comprehensive emulator such as PhantomJS.
